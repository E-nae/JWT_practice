# JWT_practice
JWT 프로젝트

1. React, Typescript, Node Express, jsonwebtoken, axios, Redux, tanstack-Query, Redis, mysql, MUI 사용
2. 기여도: frontend 100% / backend 100%
3. 성과
   1) 보안 강화
   2) 이용자 로그인 편의성 향상

--------------------------------------------------------------------------------

1. 프로세스
   1) 아이디/패스워드 로그인
   2) 액세스/리프레시 토큰 발급 및 리프레시 토큰 DB저장
      - 브라우저 쿠키에 저장
      - 토큰 생성 키는 암호화 후 redis 저장
      - 액세스 토큰 유효시간: 1시간
      - 리프레시 토큰 유효시간: 14일
   3) 재접속 시 액세스 토큰 유효성 검사
   4) 액세스 토큰이 유효한 경우 로그인 과정 패스 / 유효하지 않은 경우 리프레시 토큰 검증
      - 리프레시 토큰의 유효기간이 임박한 경우 자동 재발급 
   5) 리프레시 토큰이 유효한 경우 로그인 과정 패스 / 유효하지 않은 경우 로그인 화면 노출
   6) 로그아웃 시 액세스 / 리프레시 토큰 모두 삭제


2. 설계 전략
   1) 프론트엔드 설계
      - 상태 관리: Redux
        · 선택 이유: 코드가 상대적으로 복잡하지만, 한 번 구조를 갖추어 놓으면 대규모 프로젝트에서 사용이 용이함. reducer 관리가 필수
        · 사이트 이용 권한 여부, 이용자 아이디 상태를 관리할 때 사용
      - 캐싱: tanstack query
        · 암호화된 이용자 정보 캐싱: 인증 완료 후 서버로부터 이용자 정보를 인수
        · 사용 이유: 사용자 정보를 여러 컴포넌트에서 동시에 요청하여 메모리 누수, 서버 자원 낭비가 발생하기 때문에 자원을 절약하고자 하나의 쿼리로 관리하여 캐싱된 이용자 정보를 사용하도록 함.
      - 모든 페이지에서 jwt 인증 실행: 이용자가 아이디/패스워드 로그인을 하거나 로그인을 하지 않은 상태인 경우(로그인 페이지)를 제외하고 모든 페이지에서 검증을 하여 권한 확인.
      - 리프레시 토큰 재발급 처리ㅣ <1>, <2> 두 가지 방법 중 <1> 선택
        · 방법<1>: 리프레시 토큰의 유효기간이 임박한 경우 자동 재발급: 장기 미로그인 상태만 아니면 자동 로그인 지속
        · 방법<2>: 리프레시 토큰이 만료되면 강제 아이디/패스워드 재로그인
   2) 백엔드 설계
      - jwt 인증: jsonwebtoken
        · 가장 대중적으로 사용되는 라이브러리로, 안정성이 높음
      - jwt 토큰 발행 키
        · public.key와 private.key를 생성하여 서버에서만 사용할 수 있도록 하여 보안성을 높임.
      - 사용자 정보 암호화/복호화 키 관리: Redis
        · 클라이언트에서 키를 관리 하지 않아 보안성을 높임
        · 클라이언트에서 복호화할 때마다 서버에 키를 요청하므로 서버의 부담을 덜기 위해 가볍고 빠른 Redis 활용


-----------------------------------------------------------------------------

1. 키를 관리하는 것이 생각보다 어려운 문제였습니다. 편리하면서 간단한 방법으로 브라우저에서 관리를 하면 보안에 취약해지고, Mysql에 저장하자니 자주 써야하니 서버 자원낭비가 심해지는 상황에서 절충안을 찾아가는 과정이 다소 복잡하였으나, 여러 가지 관리 방법에 대해 알아보고 장·단점을 알 수 있어서 배우는 시간이기도 했습니다.
2. jwt 인증 후 이용자 정보를 리턴 받아오는 방식으로 하다보니 jwt의 타이밍, 순서 등을 정하고, 실행 여부 등을 지정하고, 언제 리패치를 해야하고 등등 여러 고민이 많았습니다. 특히 웹소켓과 실행 순서가 꼬여 에러가 발생하기도 했습니다. 이 때문에 처음 계획했던 프로세스를 여러번 수정해나가면서 최적의 상태를 만들어낸 것 같아 보람이 있었습니다. 

        

